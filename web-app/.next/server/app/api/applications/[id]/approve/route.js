"use strict";(()=>{var e={};e.id=856,e.ids=[856],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},58924:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>h});var n={};r.r(n),r.d(n,{POST:()=>g});var o=r(6170),a=r(8533),i=r(54387),s=r(40064),p=r(30611),l=r(26760),d=r(11027),u=r(90743);async function g(e,{params:t}){try{await (0,p.v)();let e=await l.Z.findById(t.id);if(!e)return s.Z.json({error:"Application not found"},{status:404});let r=new d.Z({name:e.username,telegramId:e.telegramId,socialNetworks:e.socialNetworks,methods:e.methods,location:e.location||{country:e.country,department:e.department,postalCode:e.postalCode},country:e.country,department:e.department,postalCode:e.postalCode,deliveryZones:e.deliveryZones,shippingZones:e.shippingZones,meetupZones:e.meetupZones,photo:e.photo||e.shopPhoto,description:e.description,isActive:!0,likes:0,referralCount:0});if(await r.save(),e.status="approved",e.reviewedAt=new Date,await e.save(),e.telegramId){let t=`âœ… <b>F\xe9licitations !</b>

Votre candidature a \xe9t\xe9 approuv\xe9e ! ðŸŽ‰

Vous \xeates maintenant un vendeur certifi\xe9 CERTIF2PLUG.
Les utilisateurs peuvent d\xe9sormais vous trouver dans la liste des plugs.

Bienvenue dans la communaut\xe9 ! ðŸ”Œ`;await (0,u.T)(e.telegramId,t)}return s.Z.json({success:!0,plug:r})}catch(e){return console.error("Approve application error:",e),s.Z.json({error:"Failed to approve application"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/applications/[id]/approve/route",pathname:"/api/applications/[id]/approve",filename:"route",bundlePath:"app/api/applications/[id]/approve/route"},resolvedPagePath:"/workspace/web-app/app/api/applications/[id]/approve/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:S,serverHooks:y,headerHooks:v,staticGenerationBailout:h}=c,f="/api/applications/[id]/approve/route";function w(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:S})}},30611:(e,t,r)=>{r.d(t,{v:()=>s});var n=r(11185),o=r.n(n);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable");let i=global.mongoose||{conn:null,promise:null};async function s(){if(i.conn)return i.conn;i.promise||(i.promise=o().connect(a,{bufferCommands:!1}));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}global.mongoose||(global.mongoose=i)},90743:(e,t,r)=>{r.d(t,{T:()=>n});async function n(e,t){let r=process.env.TELEGRAM_BOT_TOKEN,n=`https://api.telegram.org/bot${r}/sendMessage`;try{let r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:e,text:t,parse_mode:"HTML"})}),o=await r.json();if(!o.ok)return console.error("Failed to send Telegram message:",o),!1;return!0}catch(e){return console.error("Error sending Telegram message:",e),!1}}},11027:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),o=r.n(n);let a=new(o()).Schema({name:{type:String,required:!0},photo:String,description:String,methods:{delivery:{type:Boolean,default:!1},shipping:{type:Boolean,default:!1},meetup:{type:Boolean,default:!1}},deliveryDepartments:[{type:String}],deliveryPostalCodes:[{type:String}],meetupDepartments:[{type:String}],meetupPostalCodes:[{type:String}],socialNetworks:{snap:String,instagram:String,whatsapp:String,signal:String,threema:String,potato:String,telegram:String,other:String},customNetworks:[{id:String,name:String,emoji:String,link:String}],location:{country:String,department:String,postalCode:String},countries:[{type:String}],shippingCountries:[{type:String}],country:String,countryFlag:String,department:String,postalCode:String,likes:{type:Number,default:0},referralCount:{type:Number,default:0},referralLink:String,isActive:{type:Boolean,default:!0},isExample:{type:Boolean,default:!1}},{timestamps:!0});a.index({likes:-1}),a.index({referralCount:-1});let i=o().models.Plug||o().model("Plug",a)},26760:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),o=r.n(n);let a=new(o()).Schema({userId:{type:o().Schema.Types.ObjectId,ref:"User",required:!0},telegramId:{type:Number,required:!0},username:String,socialNetworks:{primary:[String],links:{type:Map,of:String},others:String},methods:{delivery:Boolean,shipping:Boolean,meetup:Boolean},deliveryZones:String,shippingZones:String,meetupZones:String,country:String,department:String,postalCode:String,photo:String,description:String,location:{country:String,department:String,postalCode:String},shopPhoto:String,status:{type:String,enum:["pending","approved","rejected"],default:"pending"},createdAt:{type:Date,default:Date.now},submittedAt:{type:Date,default:Date.now},reviewedAt:Date,reviewedBy:String}),i=o().models.VendorApplication||o().model("VendorApplication",a)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[864,386],()=>r(58924));module.exports=n})();
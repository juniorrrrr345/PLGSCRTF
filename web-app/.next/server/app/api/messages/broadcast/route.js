"use strict";(()=>{var e={};e.id=278,e.ids=[278],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},67272:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>b,originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>y});var a={};r.r(a),r.d(a,{POST:()=>p,maxDuration:()=>c,runtime:()=>u});var s=r(6170),o=r(8533),n=r(54387),i=r(40064),d=r(30611),l=r(24282);let u="nodejs",c=60;async function p(e){try{await (0,d.v)();let{message:t}=await e.json();if(!t||!t.trim())return i.Z.json({error:"Message is required"},{status:400});let r=await l.Z.find({isActive:{$ne:!1}}),a=process.env.BOT_API_URL||"https://plgscrtf-bot.onrender.com",s=await fetch(`${a}/api/broadcast`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":process.env.BOT_API_KEY||"your-secret-api-key"},body:JSON.stringify({message:t,userIds:r.map(e=>e.telegramId)})});if(!s.ok)throw Error("Failed to send broadcast message");let o=await s.json();return i.Z.json({success:!0,sent:o.sent||r.length,failed:o.failed||0})}catch(e){return console.error("Error broadcasting message:",e),i.Z.json({error:"Failed to broadcast message"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/messages/broadcast/route",pathname:"/api/messages/broadcast",filename:"route",bundlePath:"app/api/messages/broadcast/route"},resolvedPagePath:"/workspace/web-app/app/api/messages/broadcast/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:b,staticGenerationBailout:y}=m,v="/api/messages/broadcast/route";function w(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},30611:(e,t,r)=>{r.d(t,{v:()=>i});var a=r(11185),s=r.n(a);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable");let n=global.mongoose||{conn:null,promise:null};async function i(){if(n.conn)return n.conn;n.promise||(n.promise=s().connect(o,{bufferCommands:!1}));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}global.mongoose||(global.mongoose=n)},24282:(e,t,r)=>{r.d(t,{Z:()=>n});var a=r(11185),s=r.n(a);let o=new(s()).Schema({telegramId:{type:String,required:!0,unique:!0},username:String,firstName:String,lastName:String,referredBy:{type:s().Schema.Types.ObjectId,ref:"Plug"},hasBeenCountedAsReferral:{type:Boolean,default:!1},lastLikeAt:Date,likedPlugs:[{plugId:{type:s().Schema.Types.ObjectId,ref:"Plug"},likedAt:Date}],joinedAt:{type:Date,default:Date.now},isAdmin:{type:Boolean,default:!1}}),n=s().models.User||s().model("User",o)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[864,386],()=>r(67272));module.exports=a})();